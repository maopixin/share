{"version":3,"file":"Share.js","sources":["../src/utils/index.ts","../src/data/options.ts","../src/main.ts"],"sourcesContent":["/*\n * @Author: oliver\n * @Date: 2019-12-03 09:54:02\n * @LastEditTime : 2019-12-20 15:49:23\n * @LastEditors  : Please set LastEditors\n * @Description: In User Settings Edit\n * @FilePath: /share/src/utils/index.ts\n */\n/**\n * @description: 通过meta标签的name获取meta标签的内容\n * @param {string} name meta标签的名字 \n * @return {string}: meta标签的内容\n */\nexport function getMetaContentByName(name: string):string {\n    const ele = <HTMLMetaElement>document.getElementsByName(name)[0];\n    return ele ? ele.content : '';\n}\n\n/**\n * @description: 获取html文档里面的第一张图片\n * @return: html文档里面的第一张图片的地址\n */\nexport function getFirstImage():string {\n    const ele = <HTMLImageElement>document.images[0];\n    return ele ? ele.src : '';\n}\n\n/**\n * @description: 通过class获取元素的自定义属性对象\n * @param {string}} cls 元素的class（.class）\n * @return {object}: 元素的data-属性\n */\nexport function getDataSet(cls:string):object {\n    const ele = <HTMLElement>document.querySelector(cls);\n    \n\tif(ele.dataset){\n\t\treturn JSON.parse(JSON.stringify(ele.dataset));\n\t}else{\n\t\tconst attrs:NamedNodeMap = ele.attributes;\n        const len:number = attrs.length;\n        let obj:any = {};\n        \n\t\tfor (let i = 0; i < len; i++) {\n            const item = attrs[i];\n\t\t\tlet key = item.name;\n\t\t\tif(key.indexOf(\"data-\") > -1){\n                key = key.replace(/^data-/i, '').replace(/-(\\w)/g, (all, letter) => letter.toUpperCase());\n                obj[key] = item.value;\n\t\t\t}\n\t\t}\n\t\treturn obj;\n\t}\n}","/*\n * @Author: your name\n * @Date: 2019-12-20 14:54:13\n * @LastEditTime : 2019-12-20 17:14:42\n * @LastEditors  : Please set LastEditors\n * @Description: In User Settings Edit\n * @FilePath: /share/src/data/options.ts\n */\nimport { getMetaContentByName, getFirstImage } from '../utils';\n\nconst url = location.href;\nconst origin = location.origin;\nconst site = getMetaContentByName('site') || getMetaContentByName('Site') || document.title;\nconst title = getMetaContentByName('title') || getMetaContentByName('Title') || document.title;\nconst description = getMetaContentByName('description') || getMetaContentByName('Description');\nconst image = getFirstImage();\n\nexport default {\n    url,\n    origin,\n    source: site,\n    summary: '',\n    title,\n    description,\n    image,\n    imageSelector: '',\n    weiboKey: '',\n    wechatQrcodeTitle: '微信扫一扫：分享',\n    wechatQrcodeHelper: '<p>微信里点“发现”，扫一下</p><p>二维码便可将本文分享至朋友圈。</p>',\n    wechatQrcodeSize: 100,\n    sites: ['weibo', 'qq', 'wechat', 'douban', 'qzone', 'linkedin', 'facebook', 'twitter', 'google'],\n    mobileSites: [],\n    disabled: [],\n    initialized: false,\n    mode: ''\n}","/*\n * @Author: oliver\n * @Date: 2019-11-28 13:51:50\n * @LastEditTime : 2019-12-20 17:34:44\n * @LastEditors  : Please set LastEditors\n * @Description: In User Settings Edit\n * @FilePath: /share/src/main.ts\n */\nimport defaults from './data/options';\nimport urls from './data/urls';\nimport { getDataSet } from './utils/index';\nimport './style/index.less';\n\ninterface Config {\n    url: string,\n    origin: string,\n    source: string,\n    summary: string,\n    title: string,\n    description: string,\n    image: string,\n    imageSelector: string,\n    weiboKey: string,\n    wechatQrcodeTitle: string,\n    wechatQrcodeHelper: string,\n    wechatQrcodeSize: number,\n    mobileSites: Array<string>,\n    sites: Array<string>,\n    disabled: Array<string>,\n    initialized: boolean,\n    mode: string\n}\n\nclass Share {\n\n    el: string;\n    config: Config;\n    isWx: boolean = /MicroMessenger/i.test(navigator.userAgent);\n    isMobile: boolean = document.documentElement.clientWidth <= 768;\n\n    constructor(el:string = '.custom-share', config:object = {}) {\n        // 由于不想config的属性有多种类型，所以先不支持元素属性\n        // const dataConfig = getDataSet(el);\n        this.el = el;\n        this.config = {...defaults, ...config};\n        this.createIcons();\n        this.createWechat();\n    };\n    createIcons(): void {\n        this.handleSites();\n        const isPrepend: boolean = this.config.mode == 'prepend';\n        isPrepend && this.config.sites.reverse();\n        this.config.sites.forEach((name: string, index: number) => {\n            const url: string = this.makeUrl(name);\n        })\n    };\n    createWechat() {\n        \n    };\n    handleSites(): void {\n        let config: Config = this.config;\n\n        if(config.mobileSites.length == 0) {\n            config.mobileSites = config.sites;\n        }\n\n        // 如果当前环境是微信浏览器，则禁用微信分享\n        if (this.isWx) {\n            config.disabled.push('wechat');\n        };\n\n        // 删除sites中被disabled包含的部分\n        if(config.disabled.length > 0) {\n            config.disabled.forEach((e, i) => {\n                const pcSiteshasIndex: number = config.sites.indexOf(e);\n                const mbSiteshasIndex: number = config.mobileSites.indexOf(e);\n                pcSiteshasIndex > -1 && config.sites.splice(pcSiteshasIndex, 1);\n                mbSiteshasIndex > -1 && config.mobileSites.splice(mbSiteshasIndex, 1);\n            })\n        };\n    }\n    makeUrl(name: string) {\n        if (!this.config.summary){\n            this.config.summary = this.config.description;\n        }\n        \n        return '';\n    }\n};\n\nexport default Share;"],"names":[],"mappings":"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"}